#!/usr/bin/env zsh

echo "☑️  Upgrade node LTS..."
fnm install --lts
fnm default lts-latest

echo "☑️  Set global cache config..."
touch ~/.npmrc
npm config --global set cache ~/.cache/npm-cache
npm config --global set fund false
npm config --global set init-author-email "johan@borestad.com"
npm config --global set init-author-name "Johan Borestad"
npm config --global set init-author-url "http://borestad.com/"
npm config --global set init-version "0.0.1"
npm config --global set pnpm-prefix ~/.local/share/pnpm
npm config --global set store-dir ~/.local/share/.pnpm-store
npm config --global set registry https://registry.npmjs.org/

echo "☑️  Install/upgrade npm|yarn|pnpm"
npm install -g --no-audit npm yarn pnpm

args=(
  # Globals
  @babel/core@latest
  @babel/node@latest
  @microsoft/rush
  @types/node@
  bcat@latest
  cpy-cli@latest
  diff-so-fancy@latest
  empty-trash-cli@latest
  http-server@latest
  jase@latest
  jq.node@latest
  local-web-server@latest
  netlify-cli@latest
  node-notifier-cli@latest
  np@latest
  tmpin@latest
  ts-node@latest
  typescript@latest
  zx@latest
  contentful-cli@latest

  # Linters
  prettier@latest
  eslint@latest
  @typescript-eslint/eslint-plugin@latest
  @typescript-eslint/parser@latest
  eslint-config-airbnb@latest
  eslint-config-prettier@latest
  eslint-config-standard@latest
  eslint-plugin-import@latest
  eslint-plugin-jsx-a11y@latest
  eslint-plugin-node@latest
  eslint-plugin-prettier@latest
  eslint-plugin-promise@latest
  eslint-plugin-react@latest
  eslint-plugin-sonarjs@latest
  eslint-plugin-unicorn@latest
)

#NODE_ENV=production yarn global add --production --no-progress -s --link-duplicates "${args[@]}"
echo "☑️  Installing global pnpm packages..."
NODE_ENV=production pnpm add -g "${args[@]}"
#yarn global add "${args[@]}"

# yarn global remove $(yarn global list | grep info | sed 's/^info "\(.*\)@.*".*$/\1/')
# npm ls -gp --depth=0 | awk -F/ '/node_modules/ && !/\/npm$/ {print $NF}' | xargs npm -g rm
