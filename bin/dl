#!/usr/bin/env bash

set -o errexit

PWD=$(pwd)
URL=$1
BASENAME=$(basename $URL | sd '\?.*' '')
OUTPUT=${2:-$BASENAME}
TEMPFILE=$(mktemp)


# TODO: use --max-time ?

echo "ðŸš€ Downloading: $OUTPUT ..."
# ets -s -f '%s.%Ls â”ƒ  ' \
    curl \
    --silent \
    --location \
    --keepalive \
    --connect-timeout 5 \
    --retry 1 \
    --fail \
    --insecure \
    --compressed \
    --progress-bar \
    -o "$TEMPFILE" \
    "${URL}"

mv ${TEMPFILE} $PWD/$OUTPUT

SIZE=$(du -h $PWD/$OUTPUT | xargs | cut -d ' ' -f1)
echo
echo "Size: $SIZE"
