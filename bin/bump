#!/usr/bin/env dash

hr
echo "‚ú® Adding files\n"
git add . --verbose


hr
echo "‚ú® Commit files\n"

filename=''
stats=$(git diff --cached --shortstat | sed -E 's/ (insertions?|deletions?|changed?)//g' | sed 's/,//g' | xargs)
DATE=$(date '+%Y-%m-%d %H:%M:%S')

if [ $(git diff --cached --numstat | wc -l) -eq 1 ]; then
  # Only one file changed
   filename=$(basename $(git diff --cached --numstat --name-only))
   stats=$(echo $stats | sed 's/1 file//g' | xargs)

   git commit -m "\`Ô∏èÔ∏è‚ö°Ô∏è BUMP ‚ö°Ô∏è\`  \`$filename $stats\`" -a || true
else
  git commit -m "\`Ô∏èÔ∏è‚ö°Ô∏è BUMP ‚ö°Ô∏è\`  \`$stats\`" -a || true
  echo
fi

echo $filename
echo $stats

# git commit -m "ü¶Ñ \`$DATE\`  \`$stats\`" -a || true
# git commit -m "\`Ô∏èÔ∏è‚ö°Ô∏è BUMP ‚ö°Ô∏è\`  \`$stats\`" -a || true

# hr
# echo "‚ú® Push files\n"
# ~/.dotjitsu/bin/push
