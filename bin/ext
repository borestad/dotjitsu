#!/usr/bin/env bash

tempfile=`mktemp /tmp/ext.XXXXXXXXXXXXXXXXXXXXXXX.txt`

# Optimize by writing to file in one huge chunk
fd -a -i --type f --no-ignore --hidden  --one-file-system -E '.git' -E 'node_modules' -E '**cache**' \
  | tee >( tac > $tempfile ) &> /dev/null

(
  rg -N -I '^(.*/)([^/]+)$' -r '$2' |                     # Remove all paths (keep filenames only)
  rg -N -I '^[^\.]*$' -r '$0.<NO_EXTENSION>' --passthru | # Normalize files with no extension
  rg -N -I '.*(\.[^\.]+)$' -r '$1' |                      # Strip filenames (but keep extension)
  sort | uniq -c | sort -nr | tac | bat -P -l=bash        # Sort / Uniq / Output / Prettify
) < "$tempfile"


echo -e "\nTotal `wc -l < $tempfile` files"

rm $tempfile
