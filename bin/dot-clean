#!/usr/bin/env bash

cd "$(dirname $0)"/..

DISKSPACE_BEFORE=$(($(stat -f --format="%a*%S" .)))

echo ''; hr -
echo
echo "⭐️ CLEANING"
echo ''

#dfc
echo

# Disable local snapshot (APFS just hates to reclaim disk space)
echo "✓ Disable localsnapshot"
sudo tmutil disable localsnapshot

# Kill log files slowing down the shell
echo "✓ Removing *.asl"
find /private/var/log/asl -name '*.asl' | sudo xargs rm -rfv

echo "✓ Cleanup *.v8flags*"
rm -rfv ~/.v8flags*

echo "✓ Autofix +x flags"
chmod -R +x ~/.dotjitsu/bin/*

echo "✓ Brew cleanup"
brew cleanup -s &> /dev/null
rm -rf $(brew --cache) &> /dev/null

DISKSPACE_AFTER=$(($(stat -f --format="%a*%S" .)))


echo

COUNT=`expr $DISKSPACE_BEFORE - $DISKSPACE_AFTER`

echo "Disk space:"
echo "Before: $DISKSPACE_BEFORE B"
echo "After:  $DISKSPACE_AFTER B"
echo "Diff:   $COUNT B"


#dfc

#find ~/code -type d -name node_modules | xargs rm -rfv
#rm -rfv ~/.tmp/*

#npm cache clean --force
#yarn cache clean

# brew uninstall --force brew-cask;
# brew untap phinze/cask;
# brew untap caskroom/cask;
# brew update;
# brew cleanup;
# brew cask cleanup
